# 디자인 패턴 소개와 전략 패턴

> 누군가가 이미 여러분의 문제를 해결해 놓았습니다.  
1장에서는 다른 개발자가 여러분과 똑같은 문제를 경험하고 해결하면서 익혔던 지혜와 교훈을 살펴보고, 그것을 어떻게 활용할 수 있는지를 배웁니다.  
우선 디자인 패턴의 활용 분야와 디자인 패턴으로 얻을 수 있는 장점을 알아봅니다. 그리고 몇 가지 핵심적인 객체지향 디자인 원칙을 살펴본 후, 한 가지 패턴을 정해 디자인 원칙이 어떤 식으로 작동하는지 알아보겠습니다.  
패턴을 잘 사용하려면 패턴을 머릿속에 집어넣은 다음 애플리케이션에 어떻게 적용할지를 파악해야 합니다. 디자인 패턴은 코드가 아닌 경험을 재사용하는 것이니까요.

### 오리 시뮬레이션 게임, SimUduck
- 다양한 오리가 등장, 이에 따라 상속을 통해 코드를 작성했다.
- 근데 만약 제품 규격이 계속 바뀐다면?
    - 매번 `Duck`의 서브 클래스를 일일이 살펴보고 상황에 따라 다르게 오버라이드 해야 한다.
    - 코드를 재사용한다는 점에선 좋지만, 유지보수 생각한다면 좋지 않다.

#### 그렇다면 인터페이스는?
- `Flyable` 인터페이스를 만들 수도 있다.
- 그러나 메소드 몇 개를 오버라이드하기 싫어서 이런 로직을 생각한다면 바보같은 아이디어이다.
- 날아가는 동작을 조금 바꾸기 위해 `Duck`의 서브클래스에서 날아다닐 수 있는 모든 코드를 전부 고쳐야 한다.

> 즉, 상속이 올바른 방법은 아니며, 인터페이스는 일부 문제점을 해결할 수 있지만 코드를 재사용하지 않으므로 코드 관리에 문제가 생긴다.

- **결국 우리는 소프트웨어를 고칠 때 기존 코드에 미치는 영향을 최소한으로 줄이면서 작업할 수 있는 방법을 찾아야 한다!**

### 소프트웨어 개발 불변의 진리
> 변화는 언제나 우리와 함께 한다.
- 아무리 디자인을 잘한 애플리케이션이라도 시간이 지남에 따라 변화하고 성장해야 한다. 그렇지 않으면 죽고 만다.

### 문제를 명확하게 파악하기
> 디자인 원칙 : 애플리케이션에서 달라지는 부분을 찾아내고, 달라지지 않는 부분과 분리한다.
- 다시 말해 코드에 새로운 요구 사항이 있을 때마다 바뀌는 부분이 있다면 분리해야 한다.

- 바뀌는 부분은 따로 뽑아서 캡슐화한다.  
 그러면 나중에 바뀌지 않는 부분에는 영향을 미치지 않고 그 부분만 고치거나 확장할 수 있다.
- 이 개념은 간단하지만 모든 디자인 패턴의 기반을 이루는 원칙이다.
- 모든 패턴은 "시스템의 일부분을 다른 부분과 독립적으로 변화시킬 수 있는" 방법을 제공하기 때문이다.

### 바뀌는 부분과 그렇지 않은 부분 분리하기
- 변화하는 부분과 그대로 있는 부분을 분리하려면 (Duck 클래스와는 완전히 별개로) 2개의 클래스 집합(set)을 만들어야 한다.
- 하나는 나는 것과 관련된 부분이고, 다른 하나는 꽥꽥거리는 것과 관련된 부분이다.
- 각 클래스 집합에서는 각각의 행동을 구현한 것을 전부 집어넣는다. 

### 오리의 행동을 디자인하는 방법
- 나는 행동과 꽥꽥거리는 행동을 구현하는 클래스 집합은 최대한 유연하게 만드는 것이 좋다.

> 디자인 원칙 : 구현보다는 인터페이스에 맞춰서 프로그래밍한다.
- Duck의 인스턴스에 행동을 할당하는 방식으로 디자인한다.
- 각 행동은 인터페이스(FlyBehavior, QuackBehavior)로 표현하고 이런 인터페이스를 사용해서 행동을 구현한다.
- 이런 방식으로 구현하게 되면 실제 행동 구현은 Duck 서브클래스에 국한되지 안흔다.

- 즉, Duck의 행동은 (특정 행동 인터페이스를 구현한) 별도의 클래스 안에 들어있다. 그러면 Duck 클래스에서는 그 행동을 구체적으로 구현할 필요가 없다.

> "인터페이스에 맞춰서 프로그래밍한다"라는 말은  
사실 "상위 형식에 맞춰서 프로그래밍한다"라는 말이다.
- 핵심은 실제 실행 시에 쓰이는 객체가 코드에 고정되지 않도록 상위 형식(supertype)에 맞춰 프로그래밍해서 다형성을 활용해야 한다는 점에 있다.
- "상위 형식에 맞춰서 프로그래밍하라"는 원칙은  
"변수를 선언할 때 보통 추상 클래스나 인터페이스 같은 상위 형식으로 선언해야 한다. 객체를 변수에 대입할 때 상위 형식을 구체적으로 구현한 형식이라면 어떤 객체든 넣을 수 있기 때문이다. 그러면 변수를 선언한 클래스에서 실제 객체의 형식을 몰라도 된다"라는 뜻으로 생각하면 된다.
```java
// as-is
Dog d = new Dog();
d.bark();

// to-be
Animal animal = new Dog();
animal.makeSound();

// more bett to-be
a = getAnimal();
a.makeSound();
```

### 오리의 행동을 구현하는 방법
<img src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*DDxokwd03og5Cf3-Tnq6Wg.png" width=400px>

> 이런 식으로 디자인하면 다른 형식의 객체에서도 나는 행동과 꽥꽥거리는 행동을 재사용할 수 있다.  
그런 행동이 더 이상 Duck 클래스 안에 숨겨져 있지 않기 때문이다.  
그리고 기존의 행동 클래스를 수정하거나 날아다니는 행동을 사용하는 Duck 클래스를 전혀 건드리지 않아도 새로운 행동을 추가할 수 있다.
- 즉, 상속을 쓸 때 떠안게 되는 부담을 전부 떨쳐 버리고도 재사용의 장점을 그대로 누릴 수 있다.


### 오리 행동 통합하기
- 가장 중요한 점은 나는 행동과 꽥꽥거리는 행동을 Duck 클래스에서 정의한 메서드를 써서 구현하지 않고 다른 클래스에 위임한다는 것이다.

...

### 두 클래스를 합치는 방법
- "A는 B이다"보다 "A에는 B가 있다"가 나을 수 있다.
- "A에는 B가 있다" 관계를 생각해보면, 각 오리에는 FlyBehavior와 QuackBehavior가 있으며, 각각 나는 행동과 꽥꽥거리는 행동을 위임받는다.
- 이런 식으로 두 클래스를 합치는 것을 "**구성(composition)**을 이용한다"라고 부른다.
> 디자인 원칙 : 상속보다는 구성을 활용한다.

## 첫 번째 디자인 패턴 : 전략패턴
> **전략 패턴**(Strategy Pattern)은 알고리즘군을 정의하고 캡슐화해서 각각의 알고리즘군을 수정해서 쓸 수 있게 해 준다. 전략 패턴을 사용하면 클라이언트로부터 알고리즘을 분리해서 독립적으로 변경할 수 있다.

### 패턴과 전문 용어
1. 서로 알고 있는 패턴은 정말 막강하다.
2. 패턴을 사용하면 간단한 단어로 많은 얘기를 할 수 있다.
3. 패턴 수준에서 이야기하면 '디자인'에 더 오랫동안 집중할 수 있다.
4. 전문 용어를 사용하면 개발팀의 능력을 극대화할 수 있다.
5. 전문 용어는 신입 개발자에게 훌륭한 자극제가 된다.

### 디자인 패턴 사용법
- 라이브러리와 프레임워크는 개발 모델 전반에 걸쳐서 많은 영향을 미친다.
- 하지만 라이브러리와 프레임워크가 더 이해하기 쉽고, 관리하기 쉬운 유연한 방법으로 애플리케이션의 구조를 만드는 데 도움을 주지는 못한다.
- 이 도와주지 못하는 부분을 도와주는 것이 디자인 패턴이다.
- 디자인 패턴은 코드 속으로 바로 들어가는 것이 아니라, 머릿속으로 배우고, 완전히 익혀 두면 어떤 코드가 유연성 없이 엉망으로 꼬여 있는 스파게티 코드라는 사실을 금방 깨달을 수 있으며, 그 코드를 수정할 때 패턴을 적용해서 코드를 개선할 수 있다.

> 추상화나 상속, 다형성 같은 개념을 알고 있다고 해서 무조건 훌륭한 객체지향 디자이너가 될 수 있는 것은 아니다. 패턴의 밑바탕에는 객체지향 패턴이 있다.

### 핵심 정리
- 객체지향 기초 지식만 가지고는 훌륭한 객체지향 디자이너가 될 수 없다.
- 훌륭한 객체지향 디자인이라면 재사용성, 확장성, 관리의 용이성을 갖출 줄 알아야 한다.
- 패턴은 훌륭한 객체지향 디자인 품질을 갖추고 있는 시스템을 만드는 방법을 제공한다.
- 패턴은 검증받은 객체지향 경험의 산물이다.
- 패턴이 코드를 바로 제공하는 것은 아니다. 디자인 문제의 보편적인 해법을 제공한다. 특정 애플리케이션에 패턴을 적용하는 일은 여러분이 해야 한다.
- 패턴은 발명되는 것이 아니라 발견되는 것이다.
- 대부분의 패턴과 원칙은 소프트웨어의 변경 문제와 연관되어 있다.
- 대부분의 패턴은 시스템의 일부분을 나머지 부분과 무관하게 변경하는 방법을 제공한다.
- 많은 경우에 시스템에서 바뀌는 부분을 골라내서 캡슐화해야 한다.
- 패턴은 다른 개발자와의 의사소통을 극대화하는 전문 용어 역할을 한다.

