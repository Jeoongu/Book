# ch1. 도메인 모델 시작하기

### 1.1 도메인이란?
- 온라인 서점이 도메인이라면 도메인은 하위 도메인으로 나눌 수 있다.
<img src="https://blog.kakaocdn.net/dn/bLPWsu/btrBFIbHc66/lXt9ULDBbdi7LpAo9sDoTk/img.png" width=400px>

- 그러나 소프트웨어가 도메인의 모든 기능을 제공하진 않는다.
<img src="https://velog.velcdn.com/images/chaeri93/post/0248d498-070c-4d8e-90ef-ce10c6ac09b6/image.png" width=400px>

- 도메인마다 고정된 하위 도메인이 존재하는 것은 아니다. 예를 들어 모든 온라인 쇼핑몰이 고객 혜택을 제공하는 것은 아니며 규모가 크지 않은 소규모 업체는 엑셀과 같은 도구를 이용해서 수작업으로 정산을 처리할 수도 있다.
- 즉, 하위 도메인을 어떻게 구성할지 여부는 상황에 따라 달라진다.

### 1.2 도메인 전문가와 개발자 간 지식 공유
- 각 영역에는 전문가가 있다. 이들 전문가는 해당 도메인에 대한 지식과 경험을 바탕으로 본인들이 원하는 기능 개발을 요구한다.
- 개발자는 이런 요구사항을 분석하고 설계하여 코드를 작성하며 테스트하고 배포한다. 요구사항은 첫 단추와 같다.
- 도메인 전문가 만큼은 아니지만 이해관계자와 개발자도 메인 지식을 갖춰야 한다.
- Garbage in, Garbage out

### 1.3 도메인 모델
- 도메인 모델에는 다양한 정의가 존재하는데, 기본적으로 도메인 모델은 특정 도메인을 개념적으로 표현한 것이다.
<img src="https://velog.velcdn.com/images/hoo5886/post/e7d94901-1edb-4e6b-a8f3-225857c153c0/image.png" width=400px>

- 위의 사진은 객체 기반 주문 모델이다.
- 도메인을 이해하려면 도메인이 제공하는 기능과 도메인의 주요 데이터 구성을 파악해야 한다.
<img src="https://velog.velcdn.com/images%2Ffreesky%2Fpost%2Ff9534eec-dc9e-4a41-9c93-66f501d52477%2Fimage.png" width=400px>

- 도메인 모델을 객체로만 모델링 할 수 있는 것은 아니다. 상태 다이어그램을 이용해서 주문의 상태 전이를 모델링한 모습이다.
- 하위 도메인과 모델. 도메인은 다수의 하위 도메인으로 구성된다. 하위 도메인도 모델을 따로 만들어야 한다.

### 1.4 도메인 모델 패턴
<img src="https://velog.velcdn.com/images%2Ffreesky%2Fpost%2Ff2d29068-2e73-4c3d-b85a-0fd5b2dea2a8%2Fimage.png" width=400px>

- 일반적인 애플리케이션의 아키텍처는 그림과 같이 네 개의 영역으로 구성된다. 

| 영역                                    | 설명   
| ------------------------------------------ | ----------- |
| 사용자 인터페이스(UI) 또는 표현                            | 사용자의 요청을 처리하고 사용자에게 정보를 보여준다. 여기서 사용자는 소프트웨어를 사용하는 사람뿐만 아니라 외부 시스템일 수도 있다. |
| 응용(Application)                          | 사용자가 요청한 기능을 실행한다. 업무 로직을 직접 구현하지 않으면 도메인 계층을 조합해서 기능을 실행한다. |
| 도메인                          | 시스템이 제공할 도메인 규칙을 구현한다. |
| 인프라스트럭처(Infrastructure)                          | 데이터베이스나 메시징 시스템과 같은 외부 시스템과의 연동을 처리한다. |

- 도메인 자체를 이해하는 데 필요한 개념 모델을 의미한다.
- 도메인 계층은 도메인의 핵심 규칙을 구현한다.
- 도메인 모델은 아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴을 말한다.


**개념 모델과 구현 모델**
- 개념 모델은 순수하게 문제를 분석한 결과물이다. 데이터베이스, 트랜잭션 처리, 성능, 구현 기술과 같은 것을 고려하고 있지 않다
- 따라서 실제 코드를 작성할 때 개념 모델을 있는 그대로 사용할 수 없다.
- 그래서 개념 모델을 구현 가능한 형태의 모델로 전환하는 과정을 거친 것이 구현 모델이다.

### 1.5 도메인 모델 도출
- 도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것이다.
- 이 과정은 요구사항에서 출발한다. 

**문서화**
- 문서화를 하는 주된 이유는 지식을 공유하기 위함이다.
- 실제 구현은 코드에 있으므로 코드를 보면 다 알 수 있지만 그 모든 내용을 분석하려면 많은 시간이 필요하다.
- 코드를 보면서 도메인을 깊게 이해하게 되므로 코드 자체도 문서화의 대상이 된다.
- 단순히 보기 좋게 작성하는 것뿐만 아니라 도메인 관점에서 코드가 도메인을 잘 표현해야 가독성이 높아지고 문서로서 코드가 의미를 갖는다.

### 1.6 엔티티와 밸류
- 도출한 모델은 크게 엔티티(Entity)와 밸류(Value)로 구분할 수 있다.
<img src="https://velog.velcdn.com/images%2Ffreesky%2Fpost%2Fa2208b5f-da9b-40a9-9752-30b20e1af668%2Fimage.png" width=400px>

- 엔티티와 밸류를 제대로 구분해야 도메인을 올바르게 설계하고 구현할 수 있다. 따라서 이 둘의 차이를 명확히 이해하는 것이 중요하다.

#### 1.6.1 엔티티
- 엔티티의 가장 큰 특징은 식별자를 가진다는 것, 식별자는 객체마다 고유해서 각 엔티티는 서로 다른 식별자를 갖는다.

#### 1.6.2 엔티티의 식별자 생성
- 엔티티의 식별자를 생성하는 시점은 도메인의 특징과 사용하는 기술에 따라 달라진다. 흔히 다음 중 한 가지 방식으로 생성한다.

1. 특정 규칙에 따라 생성
2. UUID나 Nano ID와 같은 고유 식별자 생성기 사용
3. 값을 직접 입력
4. 일련번호 사용(시퀀스나 DB의 자동 증가 칼럼 사용)

- 식별자는 특정 규칙으로 생성하고, 이 규칙은 도메인에 따라 다르고, 같은 주문번호라도 회사마다 다르다.
- 리포지터리(repository)는 도메인 객체를 데이터베이스에 저장할 때 사용하는 구성요소이다.

#### 1.6.3 밸류 타입
- 밸류 타입은 개념적으로 완전하 하나를 표현할 때 사용한다.
<img src="https://velog.velcdn.com/images%2Ffreesky%2Fpost%2F7e43304c-a1ea-4daf-befe-cfaa57c127e5%2Fimage.png" width=400px>

- 밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식을 선호한다.
- 데이터 변경 기능을 제공하지 않는 타입을 불변(immutable)이라고 표현한다. 안전한 코드 작성을 위해 사용한다.

#### 1.6.4 엔티티 식별자와 밸류 타입
- 식별자는 단순히 문자열이 아니라 도메인에서 특별한 의미를 지니는 경우가 많기 때문에 식별자를 위한 밸류 타입을 사용해서 의미가 잘 드러나게 할 수 있다.
- ex) 식별자로 String 대신 OrderNo 밸류 타입 사용


#### 1.6.5 도메인 모델에 set 메소드 넣지 않기
- 도메인 모델에 get/set 메서드를 무조건 추가하는 것은 좋지 않은 버릇이다. 특히 set 메서드는 도메인의 핵심 개념이나 의도를 코드에서 사라지게 한다.
- 도메인 객체가 불완전한 상태로 사용되는 것을 막으려면 생성자를 사용해야 한다.
- 불변 밸류 타입을 사용하면 자연스럽게 밸류 타입에는 set 메서드를 구현하지 않는다.

##### DTO의 get/set 메서드
- DTO는 프레젠테이션 계층과 도메인 계층이 서로 주고받을 때 사용하는 일종의 구조체이다.
- DTO는 도메인 로직을 담고 있지는 않기에 get/set 메서드를 제공해도 도메인 객체의 일관성에 영향을 주지 않을 가능성이 높다.
- 하지만 요즘 프레임워크는 필드에 직접 값을 할당하는 기능을 제공하는 경우도 있다.
- 이럴 때에는 해당 기능을 최대한 활용하여 DTO도 불변 객체가 될 수 있다.

### 1.7 도메인 용어와 유비쿼터스 용어
- 코드를 작성할 때 도메인에서 사용하는 용어는 매우 중요하다.
- 도메인에서 사용하는 용어를 코드에 반영하지 않으면 그 코드는 개발자에게 코드의 의미를 해석해야 하는 부담을 준다.
```java
public OrderState{
    STEP1, STEP2, STEP3, STEP4, STEP5, STEP6
    // 잘못된 예시
}
```
- 도메인 용어에 알맞는 단어를 찾는 시간을 아까워하지 말자.
```java
public enum OrderState{
    PAYMENT_WAITING, PREPARING, SHIPPED, DELIVERING, DELIVERY_COMPLETED
    // 올바른 예시
}
```
- 코드를 가독성을 높여서 코드를 분석하고 이해하는 시간을 줄여준다.
- 유비쿼터스 언어 : 전문가, 관계자, 개발자가 도메인과 관련된 공통의 언어를 사용하는 것(하나의 언어), 이를 모든 곳에서 똑같이 사용.
